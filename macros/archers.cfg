[event]
name=start

[set_menu_item]
id=fire
description="Shoot here."

[show_if]
[have_location]
x,y=$x1,$y1
terrain={TLIST}
[/have_location]
[have_unit]
x=$selected_unit.x
y=$selected_unit.y
type=HT_Archer
underlying_id=$selected_unit.underlying_id
[filter_location]
x=$x1
y=$y1
radius=6
[/filter_location]
[/have_unit]
[not]
[have_unit]
x,y=$x1,$y1
side=$side_number
[/have_unit]
[/not]
[/show_if]
[command]
[sound]
name=bow-puny.ogg
[/sound]
[move_unit_fake]
type=HT_Arrow
side=$side_number
x=$selected_unit.x,$x1
y=$selected_unit.y,$y1
[/move_unit_fake]
[if]
[have_unit]
x,y=$x1,$y1
[/have_unit]
[then]
[store_unit]
[filter]
x,y=$x1,$y1
[/filter]
variable=killed
[/store_unit]
[kill]
x,y=$x1,$y1
type=HT_Soldier
animate=yes
[/kill]
[if]
{THEYRE_ALL_DEAD $killed.side}
[then]
[message]
speaker=narrator
message="Player $killed.side is eliminated by Player $selected_unit.side|!"
[/message]
[store_gold]
side=$killed.side
variable=gold
[/store_gold]
[gold]
side=$selected_unit.side
amount=$gold
[/gold]
[gold]
side=$killed.side
amount=-$gold
[/gold]
[sound]
name=gold.ogg
[/sound]
[unstore_unit]
variable=selected_unit
text=$gold
red,green,blue=255,255,0
[/unstore_unit]
{EVEN_THE_LEADER $killed.side}
[store_locations]
variable=allterrain
[/store_locations]
{FOREACH allterrain j}
[if]
[variable]
name=$allterrain[$j].x|_$allterrain[$j].y|.controller
equals=$killed.side
[/variable]
[then]
{CAPTURE_HEX $selected_unit.side $allterrain[$j].x| $allterrain[$j].y|}
[/then]
[/if]
{NEXT j}
[/then]
[/if]
[clear_variable]
name=allterrain
[/clear_variable]
[/then]
[/if]

{VARIABLE_OP selected_unit.attack[0].number add -1}
[unstore_unit]
variable=selected_unit
[/unstore_unit]
{CLEAR_VARIABLE selected_unit}

[store_locations]
x,y=$x1,$y1
variable=acting_hex
[/store_locations]
[switch]
variable=acting_hex.terrain

[case]
value=Hh
[terrain]
x,y=$x1,$y1
terrain=Gg
[/terrain]
[/case]

[case]
value=Gg
[terrain]
x,y=$x1,$y1
terrain=Ds
[/terrain]
[/case]

[case]
value=Ds
[terrain]
x,y=$x1,$y1
terrain=Re
[/terrain]
[/case]

[case]
value=Re
[terrain]
x,y=$x1,$y1
terrain=Uu
[/terrain]
[/case]

[case]
value=Uu
[terrain]
x,y=$x1,$y1
terrain=Qxu
[/terrain]
{MARK_CHASM $side_number $x1| $y1|}
[/case]
[/switch]
[/command]
[/set_menu_item]

[set_menu_item]
id=buy_ammo
description="Buy some ammo for this Archer."
[show_if]
[have_unit]
x,y=$x1,$y1
type=HT_Archer
side=$side_number
[not]
[filter_wml]
attacks_left=0
[/filter_wml]
[/not]
[/have_unit]
{OWNED_LOC}
[/show_if]
[command]
[store_gold]
side=$side_number
variable=gold
[/store_gold]
[message]
speaker=narrator
message="Are you sure? You have $gold gold."
[option]
message="Yes. Buy him some ammo for 20 gold."
[show_if]
[variable]
name=gold
greater_than_equal_to=20
[/variable]
[/show_if]
[command]
[gold]
side=$side_number
amount=-20
[/gold]
[object]
[filter]
x,y=$x1,$y1
[/filter]
silent=yes
[effect]
apply_to=attack
increase_attacks=1
[/effect]
[/object]
[/command]
[/option]
{NVM}
[/message]

[/command]
[/set_menu_item]
[/event]