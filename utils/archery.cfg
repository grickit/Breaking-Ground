[event]
  name = prestart

  [set_menu_item]
    id = a_shootunit
    description = _ "Shoot this unit"
    image = "buttons/resize-direction-none.png~BLIT(projectiles/missile-ne.png~SCALE(27,27),0,0)"
    [show_if]
      [have_unit]
	x,y = $x1,$y1
	[not]
	  side = $side_number
	[/not]
      [/have_unit]
      [have_location]
	[and]
	  x,y = $x1,$y1
	  radius = 6
	[/and]
	[filter]
	  type = Bowman
	  side = $side_number
	  [not]
	    [filter_wml]
	      attacks_left = 0
	    [/filter_wml]
	  [/not]
	[/filter]
      [/have_location]
    [/show_if]
    [command]
      [store_unit]
	[filter]
	  [filter_location]
	    [and]
	      x,y = $x1,$y1
	      radius = 6
	    [/and]
	    [filter]
	      type = Bowman
	      [not]
		[filter_wml]
		  attacks_left = 0
		[/filter_wml]
	      [/not]
	    [/filter]
	  [/filter_location]
	[/filter]
	variable = nearby_archers
      [/store_unit]
      {VARIABLE message.speaker "narrator"}
      {VARIABLE message.message ( _ "Which archer do you want to use?")}
      {VARIABLE message.option[0].message ( _ "Never mind.")}
      {FOREACH nearby_archers i}
	{VARIABLE message.option["$($i+1)"].message {MENU_IMG_TXT "$nearby_archers[$i].image~SCALE(36,36)~RC(magenta>$side_number].color)" ( _ "$nearby_archers[$i].name at $nearby_archers[$i].x,$nearby_archers[$i].y")}}
	{VARIABLE message.option["$($i+1)"].command.sound.name "bow.ogg"}
	{VARIABLE message.option["$($i+1)"].command.harm_unit.filter.x $x1}
	{VARIABLE message.option["$($i+1)"].command.harm_unit.filter.y $y1}
	{VARIABLE message.option["$($i+1)"].command.harm_unit.amount 1}
	{VARIABLE message.option["$($i+1)"].command.harm_unit.animate yes}
	{VARIABLE message.option["$($i+1)"].command.modify_unit.filter.x $nearby_archers[$i].x}
	{VARIABLE message.option["$($i+1)"].command.modify_unit.filter.y $nearby_archers[$i].y}
	{VARIABLE message.option["$($i+1)"].command.modify_unit.attacks_left 0}
	{VARIABLE message.option["$($i+1)"].command.scroll_to.x $nearby_archers[$i].x}
	{VARIABLE message.option["$($i+1)"].command.scroll_to.y $nearby_archers[$i].y}
      {NEXT i}
      [insert_tag]
	name = message
	variable = message
      [/insert_tag]
      {CLEAR_VARIABLE nearby_archers}
      {CLEAR_VARIABLE message}
    [/command]
  [/set_menu_item]
[/event]